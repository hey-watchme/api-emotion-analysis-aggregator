# OpenSMILE Emotion Analysis - 完全リファレンス

**作成日**: 2025-01-31  
**対象**: OpenSMILE Aggregator 精度チューニング用資料  
**目的**: eGeMAPSv02特徴量とルールベース感情分析の包括的理解

---

## 📊 eGeMAPSv02 特徴量セット（25種類）

### 1. 音響エネルギー・音量系（2種類）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `Loudness_sma3` | 知覚音量（心理音響学的音量レベル） | 怒り・喜び・驚きで高く、悲しみ・恐れで低い | 0.0-1.0 |
| `spectralFlux_sma3` | スペクトル変化量（音色の動的変化） | 感情の激しさや変動を表す | 0.0-0.5 |

### 2. 基本周波数（F0）・ピッチ系（1種類）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `F0semitoneFrom27.5Hz_sma3nz` | 基本周波数（27.5Hzからの半音単位） | 恐れ・驚きで高く、悲しみで低い | -5.0-25.0 |

### 3. 音声品質・安定性系（3種類）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `jitterLocal_sma3nz` | ピッチの短期ゆらぎ（声の震え） | 恐れ・緊張で高く、信頼で低い | 0.0-0.05 |
| `shimmerLocaldB_sma3nz` | 音量の短期ゆらぎ（dB単位） | 感情的興奮や不安定さを示す | 0.0-1.0 |
| `HNRdBACF_sma3nz` | 調和雑音比（声の清澄度） | 喜び・信頼で高く、怒りで低い | -10.0-20.0 |

### 4. スペクトル特性系（4種類）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `alphaRatio_sma3` | 高域エネルギー比（50-1000Hz vs 1000-5000Hz） | 明瞭度・感情の鋭さを表す | -20.0-5.0 |
| `hammarbergIndex_sma3` | スペクトル重心の高域指標 | 音声の明るさ・硬さを示す | 10.0-30.0 |
| `slope0-500_sma3` | 低域スペクトルスロープ（0-500Hz） | 音声の基調を表す | -0.1-0.1 |
| `slope500-1500_sma3` | 中域スペクトルスロープ（500-1500Hz） | 音声の明瞭度に関連 | -0.1-0.1 |

### 5. MFCC（メル周波数ケプストラム係数）系（4種類）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `mfcc1_sma3` | 第1MFCC係数（スペクトル包絡の基本形状） | 音色の基本特性を表す | -20.0-30.0 |
| `mfcc2_sma3` | 第2MFCC係数（スペクトルのコントラスト） | 音色の明暗を表す | -15.0-15.0 |
| `mfcc3_sma3` | 第3MFCC係数（スペクトルの詳細形状） | 音色の複雑さを表す | -10.0-20.0 |
| `mfcc4_sma3` | 第4MFCC係数（さらなる音色の詳細） | 音色の微細な特徴を表す | -10.0-10.0 |

### 6. 調和構造系（2種類）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `logRelF0-H1-H2_sma3nz` | F0と第1・第2調波の相対レベル | 音声の硬さ・柔らかさを示す | -5.0-10.0 |
| `logRelF0-H1-A3_sma3nz` | F0と第1調波・第3フォルマントの関係 | 音声の響きの質を表す | -5.0-15.0 |

### 7. フォルマント特性系（9種類）
#### F1フォルマント（口の開き度）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `F1frequency_sma3nz` | 第1フォルマント周波数 | 口の開き度、感情の開放性 | 200-1000 Hz |
| `F1bandwidth_sma3nz` | 第1フォルマント帯域幅 | 発音の明確さ | 50-2000 Hz |
| `F1amplitudeLogRelF0_sma3nz` | 第1フォルマント振幅（F0相対） | フォルマントの強さ | -200.0-0.0 dB |

#### F2フォルマント（舌の前後位置）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `F2frequency_sma3nz` | 第2フォルマント周波数 | 舌の前後位置、音色の明暗 | 800-2500 Hz |
| `F2bandwidth_sma3nz` | 第2フォルマント帯域幅 | 発音の精密さ | 50-2000 Hz |
| `F2amplitudeLogRelF0_sma3nz` | 第2フォルマント振幅（F0相対） | フォルマントの強度 | -200.0-0.0 dB |

#### F3フォルマント（舌の高さ・唇の形状）
| 特徴量名 | 説明 | 感情との関連性 | 典型的な値域 |
|---------|------|---------------|-------------|
| `F3frequency_sma3nz` | 第3フォルマント周波数 | 舌の高さ、音色の響き | 1500-4000 Hz |
| `F3bandwidth_sma3nz` | 第3フォルマント帯域幅 | 共鳴の鋭さ | 50-2000 Hz |
| `F3amplitudeLogRelF0_sma3nz` | 第3フォルマント振幅（F0相対） | 高域共鳴の強さ | -200.0-0.0 dB |

---

## 🎭 ルールベース感情分析システム

### システム概要
- **感情カテゴリ**: 8種類の基本感情（Plutchikの感情の輪に基づく）
- **判定方式**: しきい値ベースのルール判定
- **スコア計算**: 1ルール満足 = 1ポイント、スロット内合算
- **時間解像度**: 30分スロット単位（1日48スロット）

### 感情別ルール詳細

#### 1. 😡 anger（怒り）- 4ルール
**音響特性**: 高音量、振幅不安定、雑音多い、スペクトル鋭い

| No | 特徴量 | 条件 | 閾値 | 音響的意味 |
|----|--------|------|------|-----------|
| 1 | Loudness_sma3 | > | 0.30 | 大きな声で話す |
| 2 | shimmerLocaldB_sma3nz | > | 0.40 | 声の震え・不安定さ |
| 3 | HNRdBACF_sma3nz | < | 1.0 | 声が荒れている・雑音が多い |
| 4 | logRelF0-H1-A3_sma3nz | > | 10 | スペクトルが鋭く硬い音 |

#### 2. 😨 fear（恐れ）- 4ルール
**音響特性**: ピッチゆらぎ、振幅不安定、高ピッチ、高域強調

| No | 特徴量 | 条件 | 閾値 | 音響的意味 |
|----|--------|------|------|-----------|
| 1 | jitterLocal_sma3nz | > | 0.006 | 声の震え・緊張 |
| 2 | shimmerLocaldB_sma3nz | > | 0.40 | 音量の不安定さ |
| 3 | F0semitoneFrom27.5Hz_sma3nz | > | 12 | 高いピッチ（恐怖による声の上ずり） |
| 4 | alphaRatio_sma3 | < | -14 | 高域成分の強調 |

#### 3. 🤔 anticipation（期待・予期）- 3ルール
**音響特性**: スペクトル変化、フォルマント動き、中程度ピッチ

| No | 特徴量 | 条件 | 閾値 | 音響的意味 |
|----|--------|------|------|-----------|
| 1 | spectralFlux_sma3 | > | 0.05 | 音色の積極的な変化 |
| 2 | mfcc2_sma3 | > | 4.0 | フォルマントの動き |
| 3 | F0semitoneFrom27.5Hz_sma3nz | > 4 AND < | 12 | 適度に高いピッチ（期待感） |

#### 4. 😲 surprise（驚き）- 4ルール
**音響特性**: 急激な音響変化、高音量、高域ピーク、非常に高いピッチ

| No | 特徴量 | 条件 | 閾値 | 音響的意味 |
|----|--------|------|------|-----------|
| 1 | spectralFlux_sma3 | > | 0.12 | 急激なスペクトル変化 |
| 2 | Loudness_sma3 | > | 0.40 | 突然の大きな声 |
| 3 | hammarbergIndex_sma3 | > | 24 | 高域のピーク |
| 4 | F0semitoneFrom27.5Hz_sma3nz | > | 14 | 非常に高いピッチ |

#### 5. 😊 joy（喜び）- 4ルール
**音響特性**: 適度な音量、調和豊か、明るい音色、豊かな響き

| No | 特徴量 | 条件 | 閾値 | 音響的意味 |
|----|--------|------|------|-----------|
| 1 | Loudness_sma3 | > | 0.20 | 明るく聞こえる音量 |
| 2 | HNRdBACF_sma3nz | > | 2.0 | 調和の豊かな声 |
| 3 | mfcc1_sma3 | > | 20 | 明るい音色 |
| 4 | logRelF0-H1-A3_sma3nz | > | 5 | 豊かな響き |

#### 6. 😢 sadness（悲しみ）- 4ルール
**音響特性**: 小さな声、低いピッチ、スペクトル変化少、暗い音色

| No | 特徴量 | 条件 | 閾値 | 音響的意味 |
|----|--------|------|------|-----------|
| 1 | Loudness_sma3 | < | 0.10 | 小さく弱い声 |
| 2 | F0semitoneFrom27.5Hz_sma3nz | < | 3 | 低いピッチ |
| 3 | spectralFlux_sma3 | < | 0.03 | 音色の変化が少ない |
| 4 | mfcc1_sma3 | < | 15 | 暗い音色 |

#### 7. 🤗 trust（信頼・安心）- 4ルール
**音響特性**: 安定した声、適度な音量、調和豊か

| No | 特徴量 | 条件 | 閾値 | 音響的意味 |
|----|--------|------|------|-----------|
| 1 | jitterLocal_sma3nz | < | 0.003 | ピッチが安定している |
| 2 | shimmerLocaldB_sma3nz | < | 0.20 | 音量が安定している |
| 3 | HNRdBACF_sma3nz | > | 1.5 | 調和の豊かな声 |
| 4 | Loudness_sma3 | > 0.15 AND < | 0.30 | 適度で安定した音量 |

#### 8. 🤢 disgust（嫌悪・不快）- 3ルール
**音響特性**: 高域減衰、低い高域ピーク、こもった音

| No | 特徴量 | 条件 | 閾値 | 音響的意味 |
|----|--------|------|------|-----------|
| 1 | slope500-1500_sma3 | < | -0.005 | 高域の減衰（こもった感じ） |
| 2 | hammarbergIndex_sma3 | < | 18 | 低い高域ピーク |
| 3 | logRelF0-H1-H2_sma3nz | < | 0.5 | こもった音質 |

---

## 📈 サンプル出力データ

### 入力データサンプル（OpenSMILE API出力）
```json
{
  "timestamp": "08:00:00",
  "features": {
    "Loudness_sma3": 0.11434808373451233,
    "alphaRatio_sma3": -12.27481460571289,
    "hammarbergIndex_sma3": 20.94768714904785,
    "slope0-500_sma3": 0.003078457899391651,
    "slope500-1500_sma3": 0.008739800192415714,
    "spectralFlux_sma3": 0.02423585020005703,
    "mfcc1_sma3": 17.558822631835938,
    "mfcc2_sma3": 4.821182727813721,
    "mfcc3_sma3": 16.08951759338379,
    "mfcc4_sma3": -0.40721648931503296,
    "F0semitoneFrom27.5Hz_sma3nz": 8.861363410949707,
    "jitterLocal_sma3nz": 0.009178601205348969,
    "shimmerLocaldB_sma3nz": 0.26002922654151917,
    "HNRdBACF_sma3nz": 1.7042371034622192,
    "logRelF0-H1-H2_sma3nz": 0.5657048225402832,
    "logRelF0-H1-A3_sma3nz": 3.22001314163208,
    "F1frequency_sma3nz": 733.32958984375,
    "F1bandwidth_sma3nz": 1460.74658203125,
    "F1amplitudeLogRelF0_sma3nz": -159.14859008789062,
    "F2frequency_sma3nz": 1745.8458251953125,
    "F2bandwidth_sma3nz": 1172.8929443359375,
    "F2amplitudeLogRelF0_sma3nz": -161.24951171875,
    "F3frequency_sma3nz": 2674.963134765625,
    "F3bandwidth_sma3nz": 1050.5191650390625,
    "F3amplitudeLogRelF0_sma3nz": -161.66021728515625
  }
}
```

### ルール判定プロセス例
上記データでの感情ルール判定:

**fear（恐れ）の判定**:
1. ✅ jitterLocal_sma3nz (0.00918) > 0.006 → +1ポイント
2. ❌ shimmerLocaldB_sma3nz (0.260) ≤ 0.40 → 0ポイント  
3. ❌ F0semitoneFrom27.5Hz_sma3nz (8.86) ≤ 12 → 0ポイント
4. ✅ alphaRatio_sma3 (-12.27) < -14 → +1ポイント

**fear合計**: 2ポイント

### 最終出力サンプル（Aggregator出力）
```json
{
  "success": true,
  "device_id": "d067d407-cf73-4174-a9c1-d91fb60d64d0",
  "date": "2025-07-15",
  "total_slots": 48,
  "processed_slots": 3,
  "total_emotion_points": 27,
  "emotion_summary": {
    "date": "2025-07-15",
    "emotion_graph": [
      {
        "time": "00:00",
        "anger": 0, "fear": 0, "anticipation": 0, "surprise": 0,
        "joy": 0, "sadness": 0, "trust": 0, "disgust": 0
      },
      {
        "time": "00:30", 
        "anger": 0, "fear": 0, "anticipation": 0, "surprise": 0,
        "joy": 0, "sadness": 0, "trust": 0, "disgust": 0
      },
      {
        "time": "08:00",
        "anger": 1, "fear": 2, "anticipation": 1, "surprise": 0,
        "joy": 1, "sadness": 0, "trust": 2, "disgust": 0
      },
      {
        "time": "14:30",
        "anger": 3, "fear": 1, "anticipation": 2, "surprise": 1,
        "joy": 2, "sadness": 0, "trust": 1, "disgust": 1
      },
      {
        "time": "19:00",
        "anger": 0, "fear": 1, "anticipation": 3, "surprise": 0,
        "joy": 4, "sadness": 0, "trust": 3, "disgust": 0
      }
    ]
  }
}
```

---

## 🔧 チューニング指針

### 1. 閾値調整の基本原則
- **感度調整**: 閾値を下げる → 感度UP（検出しやすくなる）
- **特異度調整**: 閾値を上げる → 特異度UP（誤検出が減る）
- **バランス**: 実際の音声データで検証しながら調整

### 2. 感情別チューニングポイント

#### anger（怒り）
- `Loudness_sma3`: 0.30 → 個人差を考慮し0.25-0.35に調整可能
- `shimmerLocaldB_sma3nz`: 声の震えの個人差が大きい

#### joy（喜び）  
- `HNRdBACF_sma3nz`: 調和の豊かさは文化的差異あり
- `mfcc1_sma3`: 音色の明るさは主観的要素が強い

#### sadness（悲しみ）
- 全体的に低い値での判定のため、ノイズの影響を受けやすい
- 複数ルールの組み合わせが重要

### 3. データ収集推奨項目
- **正解ラベル**: 実際の感情状態のアノテーション
- **音響環境**: 録音環境・マイク品質の記録  
- **話者属性**: 年齢・性別・文化的背景
- **発話内容**: 自発的発話 vs 読み上げ

### 4. 精度向上手法
1. **特徴量重み付け**: 各特徴量に重み係数を導入
2. **動的閾値**: 話者適応型の閾値調整
3. **特徴量組み合わせ**: AND/OR条件の複雑化
4. **時系列パターン**: 感情変化の時間パターン活用
5. **機械学習導入**: ルールベース + MLハイブリッド

### 5. 検証方法
- **混同行列**: 8感情×8感情の分類精度
- **F1スコア**: 各感情ごとの精度・再現率
- **時系列整合性**: 感情推移の自然性評価
- **話者間汎化**: 未知話者での性能評価

---

## 📚 参考文献・仕様

### OpenSMILE eGeMAPS仕様
- **公式仕様**: [Eyben et al., 2016. The Geneva Minimalistic Acoustic Parameter Set (GeMAPS)](https://sail.usc.edu/publications/files/eyben-preprinttaffc-2015.pdf)
- **特徴量数**: eGeMAPSv02 = 25特徴量（LLD: Low-Level Descriptors）
- **計算方式**: 3次スムージング（sma3）、正規化済み（nz）

### 感情理論的背景  
- **Plutchikの感情の輪**: 8基本感情理論
- **音響感情学**: 音響特徴と感情の対応関係研究
- **言語学的知見**: フォルマント・韻律と感情表現

### システム制限事項
- **言語依存性**: 日本語話者での調整が必要
- **個人差**: 話者固有の音響特性への対応
- **環境依存**: 録音環境・品質の影響
- **文脈非考慮**: 発話内容・文脈は未考慮

---

**最終更新**: 2025-01-31  
**バージョン**: 1.0  
**次回更新**: 実測データ収集後にルール精度を検証・更新予定